{%extends "base/base.html"%} 
{%load static%} 
{%block title %}
  SARC|CampusVisit
{%endblock%} 
{% block extrahead %}
  <link
    rel="stylesheet"
    href="{% static 'css/campusVisitFront.css' %}"
  />
  <link 
  href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" 
  rel="stylesheet"
  />
{% endblock %} 

{%block content%}

<style>
  .adjust-margin-bottom{
  margin-bottom: 20px;
  }

span{
  color: #00c6fb;
  font-size: 18px;
  font-weight: 400;
}

#alumni-information-form input[type="text"],
#alumni-information-form input[type="email"],
#alumni-information-form input[type="tel"],
#alumni-information-form input[type="date"],
#alumni-information-form select,
#alumni-information-form textarea {
  height: 40px;
}

#guest-information-form input[type="text"],
#guest-information-form input[type="email"],
#guest-information-form input[type="tel"],
#guest-information-form select,
#guest-information-form textarea {
height: 40px;
}
</style>

<!-- Image Banner -->

<div class="image-banner" style="background-image: url({%static 'images/bdomeImageMain.jpeg'%});">
  <div class="line-divider"></div>
  <h1 class="left-text">Visit BITS Goa</h1>
  <p class="right-text">Whether you have a few hours or a few days, many discoveries await.</p>
</div>

<!-- Welcome Text -->
<section class="procedure-section">
  <div class="bg-white py-12">
    <div class="max-w-screen-xl mx-auto px-6">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-extrabold text-gray-900 sm:text-5xl sm:leading-10">
          Explore BITS Goa
        </h2>
        <p class="mt-4 text-xl text-gray-500">
          Fill out the form below to Visit Campus 
        </p>
      </div>
      <div class="flex justify-between">
        <div class="w-1/3 px-4">
          <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="blue"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="h-16 w-16 mx-auto mb-4"
        filter="url(#shadow)"
      >
        <defs>
          <filter id="shadow" x="0" y="0" width="200%" height="200%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="black" flood-opacity="0.5"/>
          </filter>
        </defs>
        <rect width="20" height="12" x="2" y="6" rx="2"></rect>
        <path d="M12 12h.01"></path>
        <path d="M17 12h.01"></path>
        <path d="M7 12h.01"></path>
      </svg>
          <h3 class="text-lg leading-6 font-medium text-gray-900 text-center mb-2">Submit Details</h3>
          <p class="text-base leading-6 text-gray-500 text-center">Fill the form below</p>
        </div>
        <div class="w-1/3 px-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="blue"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="h-16 w-16 mx-auto mb-4"
            filter="url(#shadow)"
            >
            <defs>
                <filter id="shadow" x="0" y="0" width="200%" height="200%">
                  <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="black" flood-opacity="0.5"/>
                </filter>
              </defs>
          >
            <rect width="20" height="16" x="2" y="4" rx="2"></rect>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
          </svg>
          <h3 class="text-lg leading-6 font-medium text-gray-900 text-center mb-2">Wait for the conformation email</h3>
          <p class="text-base leading-6 text-gray-500 text-center">
              Wait for confirmation from alumnirelations@goa.bits-pilani.ac.in
          </p>
        </div>
        <div class="w-1/3 px-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="blue"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="h-16 w-16 mx-auto mb-4"
            filter="url(#shadow)"
            >
            <defs>
                <filter id="shadow" x="0" y="0" width="200%" height="200%">
                  <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="black" flood-opacity="0.5"/>
                </filter>
              </defs>
          >
          <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
          <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <h3 class="text-lg leading-6 font-medium text-gray-900 text-center mb-2">Visit Campus</h3>
          <p class="text-base leading-6 text-gray-500 text-center">Relive your memories</p>
        </div>
      </div>
    </div>
  </div>
  </section>
<!-- Alumni Form -->
<section style="background-image: linear-gradient(to top, #00c6fb 0%, #005bea 100%);">
  <section class="form-container" id="alumni-form-section" style="padding-top: 50px;">
    <div class="container-fluid">
      
      <div class="container"></div>
        
        

      <div class="row">
        <div class="col-12 col-lg-8 m-auto">
          <!-- action="{% url 'campusVisitFront' %}" -->
            <form class= "multisteps-form__form" id="alumni-information-form" method="post" >
              <div id="errorBox" style="display: none; color: red; font-weight: bold;">
                Bro you are a BITSIAN. These errors are not expected from you:
                <div id="individual-error"></div>
              </div>
              {% csrf_token %} 
              {{alumniFormSet.management_form}}
              <!--single form panel-->
              <div class="multisteps-form__panel shadow p-4 rounded bg-white js-active" id='alumni-Form-List' data-animation="scaleIn">
                <div class="row justify-content-center">
                  <div class="col-12 text-center">
                    <h1 style="font-size: 3rem; font-weight: bold; color: black; margin-bottom: 20px;">Alumni Details</h1>
            
                  </div>
                </div>
                <hr style="border: 1.5px solid black;">
                {%for form in alumniFormSet%}
                  <div class="multisteps-form__content  alumniForm" >  
                      <div id="additional-alumni-Form-List">
                        <div class="row ">
                          <div class="col-md-12">
                            <h2 id="Alumni-Counter" style="font-size: 2rem; margin-top: 25px; margin-bottom: 0;">Alumni 1</h2>
                            <div style="display: inline-block; vertical-align: middle;" >
                              <button type="button" id="cross-0-logo" class="close" aria-label="Close" style="display:none;" onclick="removeAlumniForm(this)">
                                <span aria-hidden="true" style="color:#FF3333;">&times;</span>
                              </button>
                            </div>
                          </div>
                        </div>

                        <div class="form-row mt-4" style="margin-top: 10px !important;">
                          <div class="col-12 col-lg-6">
                            <span>First Name</span>
                            <div style="height: 5px;"></div>
                            {{form.firstName}}
                          </div>
                          <div class="col-12 col-lg-6 mt-4 mt-lg-0">
                            <span>Last Name</span>
                            <div style="height: 5px;"></div>
                            {{form.lastName}}
                          </div>
                        </div>

                        <div class="form-row mt-4" style="margin-top: 10px !important;">
                          <div class="col-12 col-lg-4">
                            <span>BITS ID</span>
                            <div style="height: 5px;"></div>
                            {{form.BitsId}}
                          </div>
                          <div class="col-12 col-lg-4 mt-4 mt-lg-0">
                            <span>Email</span>
                            <div style="height: 5px;"></div>
                            {{form.email}}
                          </div>
                          <div class="col-12 col-lg-4 mt-4 mt-lg-0">
                            <span>Phone Number</span>
                            <div style="height: 5px;"></div>
                            {{form.phoneNumber}}
                          </div>
                        </div>

                        <div class="form-row mt-4" style="margin-top: 10px !important;">
                          <div class="col">
                            <span>Address</span>
                            <div style="height: 5px;"></div>
                            {{form.currAddress}}
                          </div>
                        </div>

                        <div class="form-row mt-4" style="margin-top: 10px !important;">
                          <div class="col-12 col-lg-3 adjust-margin-bottom">
                            <span>City</span>
                            <div style="height: 5px;"></div>
                            {{form.city}}
                          </div>
        
                          <div class="col-12 col-lg-3 adjust-margin-bottom">
                            <span>State</span>
                            <div style="height: 5px;"></div>
                            {{form.state}}
                          </div>
        
                          <div class="col-12 col-lg-3 adjust-margin-bottom">
                            <span>Country</span>
                            <div style="height: 5px;"></div>
                            {{form.country}}
                          </div>
        
                          <div class="col-12 col-lg-3 adjust-margin-bottom">
                            <span>Zipcode</span>
                            <div style="height: 5px;"></div>
                            {{form.zip}}
                          </div>
                        </div>

                        <div class="form-row mt-4" style="margin-top: 10px !important;">
                          <div class="col-12 col-lg-6 ">
                            <span>Current Company</span>
                            <div style="height: 5px;"></div>
                            {{form.currCompany}}
                          </div>
                          <div class="col-12 col-lg-6 mt-4 mt-lg-0 ">
                            <span>Company Designation</span>
                            <div style="height: 5px;"></div>
                            {{form.CompanyDesignation}}
                          </div>
                        </div>

                        <div class="form-row mt-4" style="margin-top: 10px !important;">
                          <div class="col-lg-3 mt-4 mt-lg-0">
                              <!-- <input class="multisteps-form__input form-control" type="date" placeholder="Date of Visit"/> -->
                              <span>Arrival Date</span>
                              <div style="height: 5px;"></div>
                              {{form.arrivalDate}}
                          </div>
                          <div class="col-lg-9 mt-1 mt-lg-0">
                            <span>Purpose of Visit</span>
                            <div style="height: 5px;"></div>
                              {{form.purposeOfVisit}}
                          </div>
                        </div>
                      </div>
                  </div>
                {%endfor%}
              </div>
                  <div id="duelAddBtn" style="display:block;">
                  <div class="button-row d-flex mt-4 justify-content-center" >
                    <div class="col-lg-6" style="padding-left: 0;">
                      <button class="btn btn-light btn-block ml-auto btn-lg" onclick="add_alumni_form()" id="add-more-alumni" type="button" title="Send">Add another Alumni</button>
                    </div>
                    <div class="col-lg-6" style="padding-right: 0;">
                      <button class="btn btn-light btn-block ml-auto btn-lg" id="add-non-alumni-button" type="button" onclick="toggleNonAlumniPart()">Add a non-alumni</button>
                    </div>
                  </div>
                </div>

                  <div id="singleAddBtn" style="display: none;">
                    <div class="button-row d-flex mt-4 justify-content-center" >
                      <div class="col-lg-12">
                        <button class="btn btn-light btn-block ml-auto btn-lg" onclick="add_alumni_form()" id="add-more-alumni" type="button" title="Send">Add another Alumni</button>
                      </div>
                    </div>
                  </div>
                  
            </form>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Alumni Form -->
  
  
  <!-- Guest Form -->
  <section id="guest-form-section" style="margin-top: 50px;">
          <div class="container-fluid form-container guest-form-container" id="non-alumni-container-1" style="display:none">
            <div class="row">
              <div class="col-12 col-lg-8 m-auto">
                
                <form class="multisteps-form__form" id="guest-information-form" method='post' action="{% url 'campusVisitFront' %}">
                  {% csrf_token %} 
                  {{guestFormSet.management_form}}
                  <!--single form panel-->
                  <div class="multisteps-form__panel shadow p-4 rounded bg-white js-active" data-animation="scaleIn"  id="guest-Form-List">
                    <div class="row justify-content-center">
                      <div class="col-12 text-center">
                        <h1 style="font-size: 3rem; font-weight: bold; color: black; margin-bottom: 20px;">Guest Details</h1>
                      </div>
                    </div>
                    {%for form in guestFormSet%}
                    <hr style="border: 1.5px solid black;">
                      <div class="multisteps-form__content guestForm">
                        <div id="additional-guest-form-container">
                          <div class="row">
                            <div class="col-lg-12">
                              <h2 id="Guest-Counter" style="font-size: 2rem; margin-top: 25px; margin-bottom: 0;">Guest 1</h2>
                              <div style="display: inline-block; vertical-align: middle;">
                                <button type="button" class="close" id="cross-0-logo" style="display:none;" aria-label="Close" onclick="removeGuestForm(this)">
                                  <span aria-hidden="true" style="color:#FF3333;">&times;</span>
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="form-row mt-4" style="margin-top: 10px !important;">
                            <div class="col-12 col-lg-6">
                              <span>First Name</span>
                            <div style="height: 5px;"></div>
                              {{form.firstName}}
                            </div>
                            <div class="col-12 col-lg-6 mt-4 mt-lg-0">
                              <span>Last Name</span>
                              <div style="height: 5px;"></div>
                              {{form.lastName}}
                            </div>
                          </div>
                          <div class="form-row mt-4" style="margin-top: 10px !important;">
                            <div class="col-12 col-lg-6">
                              <span>Email</span>
                              <div style="height: 5px;"></div>
                              {{form.email}}
                            </div>
                            <div class="col-12 col-lg-6 mt-4 mt-lg-0">
                              <span>Phone Number</span>
                              <div style="height: 5px;"></div>
                              {{form.phoneNumber}}
                            </div>
                          </div>
                        </div>
                      </div>
                    {%endfor%}
                  </div>
                </form>
                <div class="button-row d-flex mt-4">
                  <div class="col-lg-12" >
                    <button class="btn btn-light btn-block btn-lg" type="button" id='add-more-guest'>Add another Guest</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
  </section>
  
  
  <section>
    <div class="container" style="padding-bottom: 50px;">
      <div class="row">
        <div class="col-lg-12">
          <button class="btn btn-success btn-block ml-auto btn-lg" id="submit-forms-btn" type="submit" title="Send">Submit</button>
        </div>
      </div>
    </div>
  </section>
</section>

<script>

document.addEventListener("DOMContentLoaded", function() {
    var currentTag= document.getElementsByClassName("active")
    currentTag[0].classList.remove("active");
    var element=document.getElementById("id_campusVisit");
    element.classList.add('active')
});

  // Adding Alumni form script====================================================================

  // const addMoreAlumni=document.getElementById('add-more-alumni')
  // addMoreAlumni.addEventListener('click',add_alumni_form)

  function add_alumni_form(event){
    if(event){
      event.preventDefault();
    }
    
    //Incrementing the total forms count
    const totalForms=document.getElementById('id_Alumni-TOTAL_FORMS')
    let formCount=Number(totalForms.value)
    
    if(formCount<5){
      totalForms.value=formCount+1;   
      alumniCounter=totalForms.value;
      //Creating new form element
      let form = document.querySelectorAll(".alumniForm");
      let alumniFormsCopy = form[0].cloneNode(true);
      
      //Editing the inner values
      const regex=new RegExp('-0-','g');
      alumniFormsCopy.innerHTML=alumniFormsCopy.innerHTML.replace(regex,`-${formCount}-`);

      counterHTML=alumniFormsCopy.querySelector("#Alumni-Counter");
      counterHTML.innerHTML=`Alumni ${alumniCounter}`;

      //Showing the cross button
      var temp=alumniFormsCopy.querySelector(".close");
      temp.removeAttribute("style");

      
      //Copying the new form to the target
      const alumniFormCopyTarget=document.getElementById('alumni-Form-List')    
      alumniFormCopyTarget.append(alumniFormsCopy)
    }else{
      
    }
    
  }

  // Adding Guest form script====================================================================

  const addMoreGuest=document.getElementById('add-more-guest')
  addMoreGuest.addEventListener('click',add_guest_form)

  function add_guest_form(event){
    if(event){
      event.preventDefault() 
    }
    
    //Incrementing the total forms count
    const totalForms=document.getElementById('id_Guest-TOTAL_FORMS')
    let formCount=Number(totalForms.value)

    if(formCount<5){
      totalForms.value=formCount+1   
      guestCounter=totalForms.value

      //Creating new form element
      let form = document.querySelectorAll(".guestForm")
      let guestFormsCopy = form[0].cloneNode(true)

      //Editing the inner values
      const regex=new RegExp('-0-','g');
      guestFormsCopy.innerHTML=guestFormsCopy.innerHTML.replace(regex,`-${formCount}-`);

      counterHTML=guestFormsCopy.querySelector("#Guest-Counter");
      counterHTML.innerHTML=`Guest ${guestCounter}`

      //Showing the cross button
      var temp=guestFormsCopy.querySelector(".close");
      temp.removeAttribute("style");

      //Copying the new form to the target
      const guestFormsCopyTarget=document.getElementById('guest-Form-List')    
      guestFormsCopyTarget.append(guestFormsCopy)
    }else{

    }
  }

  // Get the non-alumni part element====================================================================
  function toggleNonAlumniPart() {
      var nonAlumniPart = document.getElementById('non-alumni-container-1');
      
      if (nonAlumniPart.style.display === 'block') {
        
      }else{
        document.getElementById('duelAddBtn').style.display = 'none';
        document.getElementById('singleAddBtn').style.display = 'block';

        nonAlumniPart.style.display = 'block';
      }
  }  
  
  async function fetchData(mergedForms){
    const response = await fetch("{% url 'campusVisitFront' %}",{method: 'POST', body: mergedForms});
    if(response.ok){
      window.location.reload();
    }else{
      const data =await response.json();
      return JSON.parse(data.errors);
    }
  }

  document.getElementById('submit-forms-btn').addEventListener('click',submit_form)
  function submit_form(event){
    event.preventDefault()
    alumniForm=document.getElementById("alumni-information-form");
    guestForm=document.getElementById("guest-information-form");

    var alumniFormData= new FormData(alumniForm);
    var guestFormData= new FormData(guestForm);
    var mergedForms = new FormData();

    alumniFormData.forEach(function(value, key) {
      mergedForms.append(key, value);
    });
    var csrfToken1 = alumniForm.querySelector('input[name="csrfmiddlewaretoken"]');
    mergedForms.append('csrfmiddlewaretoken', csrfToken1.value);

    guestFormData.forEach(function(value, key) {
      mergedForms.append(key, value);
    });
    var csrfToken2 = guestForm.querySelector('input[name="csrfmiddlewaretoken"]');
    mergedForms.append('csrfmiddlewaretoken', csrfToken2.value);

    errorDiv=document.getElementById('errorDiv')

    fetchData(mergedForms).then(data=>{
      if(data.errors.length==0){
        window.location.reload();
      }else{
        var errBox=document.getElementById("errorBox")
        if(errBox.style.display === 'none'){
          errBox.style.display='block';
        }
        var singleError=document.getElementById("individual-error");
        
        data.errors.forEach(error=>{
          singleError.innerHTML=singleError.innerHTML+error[0]+"<br>";
          console.log(error[0]);
        })
      }
    }).catch(error=>{
      console.log(error)
    })
  }

  function removeAlumniForm(formInput){
    var idNum=parseInt(formInput.id.toString().split("-")[1]);

    let formList = document.getElementsByClassName("alumniForm");
    var flag=0;
    var length = formList.length;

    for (var i = 0; i <length  ; i++) {
      var regexTemp=new RegExp("Alumni-[0-4]-firstName");
      var idForm=parseInt(formList[i].innerHTML.match(regexTemp).toString().split("-")[1]);
      if(flag==1){
        var id="id_Alumni-"+idForm+"-";
        // console.log(id)
        var inputFields = [
            "firstName",
            "lastName",
            "email",
            "phoneNumber",
            "BitsId",
            "purposeOfVisit",
            "arrivalDate",
            "currCompany",
            "CompanyDesignation",
            "currAddress",
            "city",
            "state",
            "country",
            "zip"
        ];

        var valueList=[]

        inputFields.forEach(function(fieldName) {
            valueList.push(document.getElementById(id+fieldName).value);
        });

        const regex=new RegExp('-'+idForm+'-','g');
        formList[i].innerHTML=formList[i].innerHTML.replace(regex,`-${idForm-1}-`);
        
        var idNew="id_Alumni-"+(idForm-1)+"-";
        for(var j=0;j<inputFields.length;j++){
          document.getElementById(idNew+inputFields[j]).value=valueList[j];
        }
        

        counterHTML=formList[i].querySelector("#Alumni-Counter");
        counterHTML.innerHTML=`Alumni ${i+1}`;
      }

      if(idNum==idForm){
        flag=1;
        if(i>0){
          formList[i].remove();
          const totalForms=document.getElementById('id_Alumni-TOTAL_FORMS')
          totalForms.value=totalForms.value-1;
          length--;
          i--;
        }
      }      
    }
  }
  

  function removeGuestForm(formInput){
    var idNum=parseInt(formInput.id.toString().split("-")[1]);
    console.log(idNum);
    let formList = document.getElementsByClassName("guestForm");
    var flag=0;
    var length = formList.length;
    console.log(formList);

    for (var i = 0; i <length  ; i++) {
      var regexTemp=new RegExp("Guest-[0-4]-firstName");
      var idForm=parseInt(formList[i].innerHTML.match(regexTemp).toString().split("-")[1]);
      if(flag==1){
        var id="id_Guest-"+idForm+"-";
        var inputFields = [
            "firstName",
            "lastName",
            "email",
            "phoneNumber"
        ];

        var valueList=[]

        inputFields.forEach(function(fieldName) {
            valueList.push(document.getElementById(id+fieldName).value);
        });

        const regex=new RegExp('-'+idForm+'-','g');
        formList[i].innerHTML=formList[i].innerHTML.replace(regex,`-${idForm-1}-`);
        
        var idNew="id_Guest-"+(idForm-1)+"-";
        for(var j=0;j<inputFields.length;j++){
          document.getElementById(idNew+inputFields[j]).value=valueList[j];
        }
        

        counterHTML=formList[i].querySelector("#Guest-Counter");
        counterHTML.innerHTML=`Guest ${i+1}`;
      }

      if(idNum==idForm){
        flag=1;
        if(i>0){
          formList[i].remove();
          const totalForms=document.getElementById('id_Guest-TOTAL_FORMS')
          totalForms.value=totalForms.value-1;
          length--;
          i--;
        }
      }      
    }
  }
</script>
{%endblock%}